@using System.IO
@model Destiny.ScrimTracker.App.Requests.CreateMatchFormModel

@{
    ViewBag.Title = "Create Match";
    var guardians = ViewBag.Guardians;
}

<h2>Add Match</h2>
@using (Html.BeginForm("FormatRequestAndAddMatch", "Match", FormMethod.Post))
{
    <div>
        @Html.LabelFor(req => req.MatchType)
    </div>
    <div>
        @Html.DropDownListFor(req => req.MatchType, Html.GetEnumSelectList<Destiny.ScrimTracker.Logic.Models.MatchType>())
    </div>
    
    <fieldset class="alpha-team">
        <legend class="teamForm-header">Alpha Team</legend>
        Team Score: 
        <input name="Team[0].TeamScore"/>
        <input name="Team[0].Name" value="Alpha" hidden="true"/>
        
        <ul class="alpha-guardian-form">
            <li class="alpha-guardian">
                Guardian: @Html.DropDownList("Team[0].MatchResults[0].GuardianName", new SelectList(guardians))
                Kills: <input name="Team[0].MatchResults[0].Kills"/>
                Assists: <input name="Team[0].MatchResults[0].Assists"/>
                Deaths: <input name="Team[0].MatchResults[0].Deaths"/>
            </li>
        </ul>
        <button onclick="addGuardian('alpha')" type="button" class="btn btn-outline-primary btn-sm">Add Another Guardian</button>
    </fieldset>
    <fieldset class="bravo-team">
        <legend class="teamForm-header">Bravo Team</legend>
        Team Score: 
        <input name="Team[1].TeamScore"/>
        <input name="Team[1].Name" value="Bravo" hidden="true"/>
        
        <ul class="bravo-guardian-form">
            <li class="bravo-guardian">
                Guardian: @Html.DropDownList("Team[1].MatchResults[0].GuardianName", new SelectList(guardians))
                Kills: <input name="Team[1].MatchResults[0].Kills"/>
                Assists: <input name="Team[1].MatchResults[0].Assists"/>
                Deaths: <input name="Team[1].MatchResults[0].Deaths"/>
            </li>
        </ul>
        <button onclick="addGuardian('bravo')" type="button" class="btn btn-outline-primary btn-sm">Add Another Guardian</button>
    </fieldset>
    <button type="submit" value="Create Match" class="btn btn-primary">Create Match</button>
}

<script type="text/javascript">
function addGuardian(teamName) {
  console.log(teamName+'-guardian')
  var guardianCount = document.getElementsByClassName(teamName+'-guardian').length;
  
  console.log(guardianCount)
  var newGuardianInput = document.querySelector('.'+teamName+'-guardian').cloneNode(true);
  var childrenNodes = newGuardianInput.childNodes;
  for (var i = 0; i < childrenNodes.length; i++)
  {
    var nodeType = childrenNodes[i].nodeName;
          
      if (nodeType != "#text")
      {
          var childName = childrenNodes[i].name;
          console.log(childName);
          var newName = childName.replace('MatchResults[0]', 'MatchResults['+guardianCount+']');
          console.log(newName)
          childrenNodes[i].setAttribute("name", newName);
      }
  }
  
  document.querySelector('.'+teamName+'-guardian-form').appendChild(newGuardianInput);
}

</script>